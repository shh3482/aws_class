<!DOCTYPE html>
<html 
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
	layout:decorate="~{layout/layout.html}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body >
	<main layout:fragment="content" class="container">
		<h1>게시글 수정</h1>
		<form th:action="@{/post/update/{num}(num=${post.po_num})}" method="post"
		 enctype="multipart/form-data">
			<div class="mb-3 mt-3">
				<label for="title" class="form-label">제목:</label> 
				<input
					type="text" class="form-control" id="title"
					th:value="${post.po_title}" name="title">
			</div>
			<div class="mb-3 mt-3">
				<label for="content" class="form-label">내용:</label> 
				<textarea
					class="form-control" id="content"
					th:text="${post.po_content}" name="content"
					rows="15"></textarea>
			</div>
			<div class="mb-3">
				<label>첨부파일</label>
				<a href="javascript:void(0);"
				th:each="file : ${files}"
				class="form-control mb-3 file-item d-flex justify-content-between">
				<span th:text="${file.fi_ori_name}"></span>
				<span class="badge bg-secondary"
				th:data-target="${file.fi_num}"
				onclick="removeFile(this)">&times;
				</span>
				</a>
				<th:block th:if="${files.size()!=3}">
				
					<input type="file" name="files" class="form-control mb-3"
					th:each="num : ${#numbers.sequence(files.size()+1,3)}">
				</th:block>
			</div>
			<button class="btn btn-outline-success col-12">게시글 수정</button>
		</form>
		<script type="text/javascript">
		function removeFile(element){
			const aTag = element.closest('.file-item');
			const parent = aTag.parentNode;
			
			const newFileInput = document.createElement('input');
			
			const delFileInput = document.createElement('input');
			
			const fileNum = element.dataset.target;
			
			newFileInput.type = 'file';
			newFileInput.name = 'files';
			newFileInput.className = 'form-control mb-3';
			
			delFileInput.type = 'hidden';
			delFileInput.name = 'delFileNums';
			delFileInput.value = fileNum;
			
			parent.appendChild(newFileInput);
			parent.appendChild(delFileInput);
			
			aTag.remove();
		}
		</script>
	</main>
</body>
</html>






